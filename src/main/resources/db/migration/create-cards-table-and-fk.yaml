databaseChangeLog:
    - changeSet:
          id: create-cards-table
          author: rollip
          preConditions:
            onFail: MARK_RAN
            not:
              tableExists:
                tableName: cards
                schemaName: public
          changes:
              - createTable:
                    tableName: cards
                    columns:
                        - column:
                              name: id
                              type: BIGINT
                              autoIncrement: true
                              constraints:
                                  primaryKey: true
                                  nullable: false
                        - column:
                              name: number
                              type: VARCHAR(255)
                              constraints:
                                  nullable: false
                                  unique: true
                        - column:
                              name: expiry_date
                              type: DATE
                              constraints:
                                  nullable: false
                        - column:
                              name: status
                              type: VARCHAR(20)
                              constraints:
                                  nullable: false
                        - column:
                              name: balance
                              type: NUMERIC(15,2)
                              constraints:
                                  nullable: false
                        - column:
                              name: owner_id
                              type: BIGINT
                              constraints:
                                  nullable: false
          rollback:
            - dropTable:
                tableName: cards


    - changeSet:
        id: create-card-owner-fk
        author: rollip
        preConditions:
            not:
              foreignKeyConstraintExists:
                foreignKeyName: fk_card_owner
                tableName: cards
            onFail: MARK_RAN
        changes:
          - addForeignKeyConstraint:
              baseTableName: cards
              baseColumnNames: owner_id
              referencedTableName: users
              referencedColumnNames: id
              constraintName: fk_card_owner
              onDelete: CASCADE
        rollback:
          - dropForeignKeyConstraint:
              baseTableName: cards
              constraintName: fk_card_owner